set.seed(12345)
data = read.csv("/home/gusli281/Documents/tdde07/WomenAtWork.dat", header = TRUE, sep = "")
data = read.csv("WomenAtWork.dat", header = TRUE, sep = "")
View(data)
View(data)
View(data)
library(mvtnorm)
set.seed(12345)
data = read.csv("WomenAtWork.dat", header = TRUE, sep = "")
theta = 5
x = data[,-1]
View(x)
library(mvtnorm)
set.seed(12345)
data = read.csv("WomenAtWork.dat", header = TRUE, sep = "")
t = 5
matrix_size = 7
prior_sigma = t^2*diag(matrix_size)
x = data[,-1] #all rows not first col
betaPrior = dmvnorm(x, 0, prior_sigma)
betaPrior = dmvnorm(x, matrix(0, 7, 7), prior_sigma)
betaPrior = dmvnorm(x, c(0, 7, 7), prior_sigma)
betaPrior = dmvnorm(x, matrix(0, 7, 168), prior_sigma)
betaPrior = dmvnorm(x, c(0, 1, 7), prior_sigma)
betaPrior = dmvnorm(x, c(0, 7, 1), prior_sigma)
betaPrior = dmvnorm(x, matrix(0, 7, 1), prior_sigma)
betaPrior
mu <- as.matrix(rep(0,Npar))
mu <- as.matrix(rep(0,Npar))
library(mvtnorm)
set.seed(12345)
data = read.csv("WomenAtWork.dat", header = TRUE, sep = "")
t = 5
Npar = 7 #matrix size
prior_sigma = t^2*diag(Npar)
X = data[,-1] #all rows not first col
mu <- as.matrix(rep(0,Npar))
betaPrior = dmvnorm(X, mu, prior_sigma)
betas = rmvnorm(nDraws, mu, t*diag(Npar))
nDraws = 1000
betas = rmvnorm(nDraws, mu, t*diag(Npar))
View(betas)
View(betas)
#2a
library(mvtnorm)
set.seed(12345)
data = read.csv("WomenAtWork.dat", header = TRUE, sep = "")
t = 5
Npar = 7 #matrix size
Sigma = t^2*diag(Npar)
X = data[,-1] #all rows not first col
nDraws = 1000
mu <- as.matrix(rep(0,Npar))
initVal = matrix(0, Npar, 1)
y = data$Work
LogPostLogistic <- function(betas,y,X,mu,Sigma){ #from lecture
linPred <- X%*%betas;
logLik <- sum( linPred*y - log(1 + exp(linPred)) );
#if (abs(logLik) == Inf) logLik = -20000; # Likelihood is not finite, stear the optimizer away from here!
logPrior <- dmvnorm(betas, mu, Sigma, log=TRUE);
return(logLik + logPrior)
}
betas = rmvnorm(nDraws, mu, t*diag(Npar))
betaPrior = dmvnorm(X, mu, prior_sigma)
optimRes = optim(initVal,LogPostLogistic, gr=NULL, y, X,mu, Sigma, method=c("BFGS"), control=list(fnscale=-1), hessian=TRUE)
#2a
library(mvtnorm)
set.seed(12345)
data = read.csv("WomenAtWork.dat", header = TRUE, sep = "")
t = 5
Npar = 7 #matrix size
Sigma = t^2*diag(Npar)
X = as.matrix(data[,-1]) #all rows not first col
nDraws = 1000
mu <- as.matrix(rep(0,Npar))
initVal = matrix(0, Npar, 1)
y = data$Work
LogPostLogistic <- function(betas,y,X,mu,Sigma){ #from lecture
linPred <- X%*%betas;
logLik <- sum( linPred*y - log(1 + exp(linPred)) );
#if (abs(logLik) == Inf) logLik = -20000; # Likelihood is not finite, stear the optimizer away from here!
logPrior <- dmvnorm(betas, mu, Sigma, log=TRUE);
return(logLik + logPrior)
}
betas = rmvnorm(nDraws, mu, t*diag(Npar))
betaPrior = dmvnorm(X, mu, prior_sigma)
optimRes = optim(initVal,LogPostLogistic, gr=NULL, y, X,mu, Sigma, method=c("BFGS"), control=list(fnscale=-1), hessian=TRUE)
View(optimRes)
names(optimRes$par) = colnames(X)
optimRes$par
optimRes
#names(optimRes$par) = colnames(X)
JInv = solve(-optimRes)
#names(optimRes$par) = colnames(X)
JInv = solve(-optimRes$hessian)
View(JInv)
beta_tilde = optimRes$par
plot(X[,6], y)
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
View(betas_posterior)
bottom_95_child = apply(betas_posterior$NSmallChild, 1, function(x) quantile(x,0.025))
top_95_child = apply(betas_posterior$NSmallChild, 1, function(x) quantile(x, 0.975))
bottom_95_child = apply(betas_posterior[,6], 1, function(x) quantile(x,0.025))
top_95_child = apply(betas_posterior[,6], 1, function(x) quantile(x, 0.975))
betas_posterior[,6]
bottom_95_child = apply(betas_posterior[,6], 1, function(x) quantile(x,0.025))
top_95_child = apply(betas_posterior[,6], 1, function(x) quantile(x, 0.975))
bottom_95_child = apply(betas_posterior[,6], 0, function(x) quantile(,0.025))
top_95_child = apply(betas_posterior[,6], 0, function(x) quantile(x, 0.975))
bottom_95_child = apply(betas_posterior[,6], 0, function(x) quantile(x,0.025))
top_95_child = apply(betas_posterior[,6], 0, function(x) quantile(x, 0.975))
bottom_95_child = quantile(betas_posterior[,6],0.025)
top_95_child = quantile(betas_posterior[,6],0.975)
glm.model = glm(Work~0+., data = data, family = binomial)
View(glm.model)
X_43 = c(1, 20, 12, 8, 43, 1, 1) #woman described in lab
probs = exp(X_43 %*% betas_posterior) / (1 + exp(X_43 %*% betas_posterior))
probs = exp(t(X_43) %*% betas_posterior) / (1 + exp(t(X_43) %*% betas_posterior))
betas_posterior
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior))
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
plot(probs)
plot(density(probs))
X_43 = c(1, 20, 12, 8, 43, 1, 1) #woman described in lab
probs_woman <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
return(probs)
}
probs = probs_woman(X_43, nDraws, beta_tilde, JInv)
plot(density(probs))
set.seed(12345)
set.seed(12345)
X_43 = c(1, 20, 12, 8, 43, 1, 1) #woman described in lab
probs_woman <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
return(probs)
}
probs = probs_woman(X_43, nDraws, beta_tilde, JInv)
plot(density(probs))
set.seed(12345)
X_43 = c(1, 20, 12, 8, 43, 1, 1) #woman described in lab
probs_woman <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
return(probs)
}
probs = probs_woman(X_43, nDraws, beta_tilde, JInv)
plot(density(probs))
#c
probs_avg = mean(probs)
women_working = rbern(11, prob=probs_avg)
women_working = rbinom(nDraws, 11, probs_avg)
plot(density(women_working))
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
set.seed(12345)
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
women_working <- function(X, nDraws, beta_tilde, JInv) {
betas_posterior = rmvnorm(nDraws, beta_tilde, JInv)
probs = exp(t(X_43) %*% t(betas_posterior)) / (1 + exp(t(X_43) %*% t(betas_posterior)))
probs_avg = mean(probs)
women_working = rbinom(nDraws, 11, probs_avg)
return(women_working)
}
women_working = women_working(X, nDraws, beta_tilde, JInv)
plot(hist(women_working))
